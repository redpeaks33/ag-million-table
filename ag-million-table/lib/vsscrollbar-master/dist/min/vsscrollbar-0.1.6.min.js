/* 
*  Name: vsscrollbar 
*  Description: Virtual scroll with filtering and custom scrollbar - AngularJS reusable UI component 
*  Homepage: http://kekeh.github.io/vsscrollbar 
*  Version: 0.1.6 
*  Author: kekeh 
*  License: MIT 
*  Date: 2016-01-13 
*/ 
angular.module('template-vsscrollbar-0.1.6.html', []).run(['$templateCache', function($templateCache) {
  $templateCache.put("templates/vsscrollbar.html",
    "<table class=vsscrollbarcontainer ng-show=\"filteredItems.length > 0\" style=border-collapse:separate;border-spacing:0;padding:0;height:100%><tr><td style=width:100%;padding:0;vertical-align:top><div class=vsscrollbarcontent ng-style=\"{'margin': scrollbarVisible ? '1px 0 1px 1px' : '1px'}\" style=overflow-y:hidden;padding:0;outline:0 ng-transclude></div></td><td style=padding:0;height:100%><div class=vsscrollbar ng-show=scrollbarVisible style=float:right;height:100%;padding:0;margin:1px><div class=vsscrollbox tabindex=0 ng-focus=scrollBoxFocus() ng-blur=scrollBoxBlur() ng-style=\"{'height': boxHeight + 'px'}\" ng-click=$event.stopPropagation() style=position:relative;padding:0;outline:0></div></div></td></tr></table>");
}]);

angular.module("vsscrollbar",["template-vsscrollbar-0.1.6.html"]).constant("vsscrollbarConfig",{ITEMS_IN_PAGE:6,SCROLLBAR_HEIGHT:0,SCROLLBOX_MIN_HEIGHT:18}).factory("vsscrollbarEvent",function(){function a(a,b,c){a.$broadcast("vsmessage",{type:b,value:c})}var b={};return b.setIndex=function(b,c){a(b,"setIndex",c)},b.setPosition=function(b,c){a(b,"setPosition",c)},b.filter=function(b,c){a(b,"filter",c)},b.addItem=function(b,c,d){a(b,"addItem",{index:c,item:d})},b.updateItem=function(b,c,d){a(b,"updateItem",{index:c,item:d})},b.deleteItem=function(b,c){a(b,"deleteItem",c)},b}).service("vsscrollbarService",function(){this.calcIndex=function(a,b,c){var d=0;return this.checkIsMaxPos(a,c)?d=b:a>0&&(d=this.validateIndex(Math.round(a/c*b),b)),d},this.calcScrollPos=function(a,b,c){var d=0;return a>0&&(d=this.checkIsMaxIndex(a,b)?c:Math.round(a/b*c)),this.validatePos(d,c,a,b)},this.validateIndex=function(a,b){return 0>=a?0:this.checkIsMaxIndex(a,b)?b:a},this.validatePos=function(a,b,c,d){return angular.isUndefined(c)||angular.isUndefined(d)?0>=a?0:a>=b?b:a:0>=a&&c>0?1:a>=b&&d>c?b-1:a},this.checkIsMaxIndex=function(a,b){return a>=b},this.checkIsMaxPos=function(a,b){return a>=b}}).directive("vsscrollbar",["$filter","$timeout","$document","vsscrollbarService","vsscrollbarConfig",function(a,b,c,d,e){return{restrict:"AE",multiElement:!0,scope:{ngModel:"=?",items:"=items",onScrollChangeFn:"&",onFocusScrollboxFn:"&"},transclude:!0,templateUrl:"templates/vsscrollbar.html",link:function(f,g,h){function i(a){a.preventDefault(),I=angular.isUndefined(a.changedTouches)?a.clientY-L:a.changedTouches[0].clientY-L,c.on(angular.isUndefined(a.changedTouches)?"mousemove":"touchmove",j),c.on(angular.isUndefined(a.changedTouches)?"mouseup":"touchend",k)}function j(a){var b=angular.isUndefined(a.changedTouches)?a.clientY-I:a.changedTouches[0].clientY-I;v(d.validatePos(b,M)),f.$apply()}function k(a){c.off(angular.isUndefined(a.changedTouches)?"mousemove":"touchmove",j),c.off(angular.isUndefined(a.changedTouches)?"mouseup":"touchend",k)}function l(a){I=a.changedTouches[0].clientY,c.on("touchmove",m),c.on("touchend",n)}function m(a){a.preventDefault();var b=a.changedTouches[0].clientY;x(I>b?G:-G),I=b,f.$apply()}function n(){c.off("touchmove",m),c.off("touchend",n)}function o(a){var b=a.offsetY||a.layerY;v(d.validatePos(b<f.boxHeight?0:b,M)),f.$apply()}function p(){F[0].focus()}function q(a){var a=window.event||a;a.preventDefault();var b=(a.wheelDelta||-a.detail)<=0;x(b?G:-G)}function r(a){(38===a.which||40===a.which)&&(a.preventDefault(),x(38===a.which?-G:G))}function s(a,b){"setIndex"===b.type&&b.value!==J&&b.value>=0?w(Math.round(b.value),!0):"setPosition"===b.type&&b.value!==L&&b.value>=0?v(d.validatePos(Math.round(b.value),M)):"filter"===b.type?(N=b.value,t(N,0)):"addItem"===b.type&&b.value.index>=0&&b.value.index<=f.items.length?(f.items.splice(b.value.index,0,b.value.item),t(N,J)):"updateItem"===b.type&&b.value.index>=0&&b.value.index<f.items.length?(f.items[b.value.index]=b.value.item,t(N,J)):"deleteItem"===b.type&&b.value>=0&&b.value<f.items.length&&(f.items.splice(b.value,1),t(N,J))}function t(b,c){f.filteredItems=""===b?f.items:a("filter")(f.items,b),f.scrollbarVisible=f.filteredItems.length>G,u(),w(c,!1)}function u(){var a=Math.floor(H/(f.filteredItems.length/G));f.boxHeight=a<e.SCROLLBOX_MIN_HEIGHT?e.SCROLLBOX_MIN_HEIGHT:a,K=f.filteredItems.length-G<0?0:f.filteredItems.length-G,M=H-f.boxHeight<0?0:H-f.boxHeight}function v(a){(a=Math.round(a))!==L&&(L=a,J=d.calcIndex(L,K,M),y())}function w(a,b){(a=d.validateIndex(a,K))===J&&b||(J=a,L=d.calcScrollPos(J,K,M),y())}function x(a){w(J+a,!0),f.$apply()}function y(){F.css("top",L+"px"),z()}function z(){var a={topIndex:J,maxIndex:K,topPos:L,maxPos:M,filteredPageCount:f.filteredItems.length/G,filteredItemCount:f.filteredItems.length,visibleItems:A()};f.onScrollChangeFn(a),f.ngModel=a}function A(){return f.filteredItems.slice(J,J+G)}function B(){f.filteredItems=f.items,0===H?b(C,0):(E.css("height",H+"px"),u()),w(0,!1)}function C(){H=D.prop("offsetHeight"),E.css("height",H+"px"),u()}f.filteredItems=[];var D=angular.element(g[0].querySelector(".vsscrollbarcontent")),E=angular.element(g[0].querySelector(".vsscrollbar")),F=E.children(),G=angular.isUndefined(h.itemsInPage)?e.ITEMS_IN_PAGE:f.$eval(h.itemsInPage),H=angular.isUndefined(h.height)?e.SCROLLBAR_HEIGHT:f.$eval(h.height),I=0,J=0,K=0,L=0,M=0,N="";f.boxHeight=e.SCROLLBOX_MIN_HEIGHT,f.scrollbarVisible=!0,f.scrollBoxFocus=function(){f.onFocusScrollboxFn({focused:!0})},f.scrollBoxBlur=function(){f.onFocusScrollboxFn({focused:!1})},F.on("mousedown touchstart",i),D.on("touchstart",l),E.on("click",o),F.on("click",p),D.on("mousewheel DOMMouseScroll",q),E.on("mousewheel DOMMouseScroll",q),F.on("keydown",r),f.$on("vsmessage",s),f.$on("$destroy",function(){F.off("mousedown touchstart",i),D.off("touchstart",l),E.off("click",o),F.off("click",p),D.off("mousewheel DOMMouseScroll",q),E.off("mousewheel DOMMouseScroll",q),F.off("keydown",r)}),B()}}}]);